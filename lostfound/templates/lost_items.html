{%load static%}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lost Items - Reclaima</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="{% static 'css/lost_items.css' %}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="container header-container">
        <a href="index.html" class="logo">
          <i class="fas fa-search"></i>
          Reclaim<span>a</span>
        </a>

        <nav>
          <ul>
            <li><a href="{% url 'home' %}">Home</a></li>
            <li>
              <a href="{% url 'lostItems' %}" class="active">Lost Items</a>
            </li>
            <li><a href="{% url 'found' %}">Found Items</a></li>
            <li><a href="{% url 'howItWorks' %}">How It Works</a></li>
            <li><a href="{% url 'successStories' %}">Success Stories</a></li>
          </ul>
        </nav>

        <div class="cta-buttons">
          <button class="cta-button" id="reportItemBtn">Report Item</button>
        </div>

        <div class="mobile-menu">
          <i class="fas fa-bars"></i>
        </div>
      </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
      <div class="container">
        <h1 class="page-title">Lost Items</h1>
        <p class="page-subtitle">
          Browse through items reported as lost. If you see something that
          belongs to you, you can claim it directly. If you've lost something,
          use the filters to narrow down your search or report a new lost item.
        </p>
      </div>
    </section>

    <!-- Main Content -->
    <div class="container">
      <div class="main-content">
        <!-- Filter Sidebar -->
        <aside class="filter-sidebar">
          <h2 class="filter-title">
            <i class="fas fa-filter"></i> Filter Results
          </h2>

          <!-- Search -->
          <div class="filter-group">
            <h3>Search</h3>
            <input
              type="text"
              id="searchInput"
              placeholder="Type item name or description..."
              style="
                width: 100%;
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 1rem;
              "
            />
          </div>

          <!-- Category -->
          <div class="filter-group">
            <h3>Category</h3>
            <div class="filter-options">
              <div class="filter-option">
                <input type="checkbox" id="cat-electronics" checked />
                <label for="cat-electronics">Electronics</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-keys" checked />
                <label for="cat-keys">Keys & Access</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-wallets" checked />
                <label for="cat-wallets">Wallets & Purses</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-documents" />
                <label for="cat-documents">Documents</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-jewelry" />
                <label for="cat-jewelry">Jewelry & Accessories</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-clothing" />
                <label for="cat-clothing">Clothing</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-bags" />
                <label for="cat-bags">Bags & Luggage</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-other" />
                <label for="cat-other">Other</label>
              </div>
            </div>
          </div>

          <!-- Location -->
          <div class="filter-group">
            <h3>Location</h3>
            <select
              id="locationFilter"
              style="
                width: 100%;
                padding: 10px 15px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 1rem;
              "
            >
              <option value="all">All Locations</option>
              <option value="downtown">Downtown</option>
              <option value="north">North District</option>
              <option value="south">South District</option>
              <option value="east">East Side</option>
              <option value="west">West Side</option>
              <option value="transport">Public Transport</option>
              <option value="airport">Airport</option>
            </select>
          </div>

          <!-- Date Lost -->
          <div class="filter-group">
            <h3>Date Lost</h3>
            <div class="date-inputs">
              <input type="date" id="dateFrom" />
              <input type="date" id="dateTo" />
            </div>
          </div>

          <!-- Status -->
          <div class="filter-group">
            <h3>Status</h3>
            <div class="filter-options">
              <div class="filter-option">
                <input type="checkbox" id="status-unclaimed" checked />
                <label for="status-unclaimed">Unclaimed</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="status-claimed" />
                <label for="status-claimed">Claimed</label>
              </div>
            </div>
          </div>

          <!-- Filter Buttons -->
          <div class="filter-buttons">
            <button class="filter-btn apply-btn" id="applyFilters">
              Apply Filters
            </button>
            <button class="filter-btn reset-btn" id="resetFilters">
              Reset
            </button>
          </div>
        </aside>

        <!-- Items Grid -->
        <main class="items-container">
          <div class="items-header">
            <div class="items-count">
              Showing <span id="itemsShown">8</span> of
              <span id="itemsTotal">24</span> lost items
            </div>
            <div class="sort-options">
              <span>Sort by:</span>
              <select id="sortBy">
                <option value="recent">Most Recent</option>
                <option value="oldest">Oldest First</option>
                <option value="location">Location</option>
                <option value="category">Category</option>
              </select>
            </div>
          </div>

          <div class="items-grid" id="lostItemsGrid">
            <!-- Item cards will be dynamically generated here -->
          </div>

          <!-- Pagination -->
          <div class="pagination">
            <button class="page-btn active">1</button>
            <button class="page-btn">2</button>
            <button class="page-btn">3</button>
            <button class="page-btn">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </main>
      </div>

      <!-- Report Section -->
      <section class="report-section">
        <h2 class="report-title">Can't Find What You're Looking For?</h2>
        <p class="report-text">
          If you've lost something and don't see it listed here, you can report
          it to our community. The more details you provide, the better chance
          you have of getting it back.
        </p>
        <button class="cta-button" id="openReportModal">
          Report a Lost Item
        </button>
      </section>
    </div>

    <!-- Report Item Modal -->
    <div class="modal" id="reportModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Report a Lost Item</h2>
          <button class="close-modal" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="reportForm">
            <div class="form-row">
              <div class="form-group">
                <label for="itemName">Item Name *</label>
                <input
                  type="text"
                  id="itemName"
                  placeholder="e.g., iPhone 12, Black Wallet, Car Keys"
                  required
                />
              </div>
              <div class="form-group">
                <label for="itemCategory">Category *</label>
                <select id="itemCategory" required>
                  <option value="">Select a category</option>
                  <option value="electronics">Electronics</option>
                  <option value="keys">Keys & Access</option>
                  <option value="wallets">Wallets & Purses</option>
                  <option value="documents">Documents</option>
                  <option value="jewelry">Jewelry & Accessories</option>
                  <option value="clothing">Clothing</option>
                  <option value="bags">Bags & Luggage</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="lostDate">Date Lost *</label>
                <input type="date" id="lostDate" required />
              </div>
              <div class="form-group">
                <label for="lostLocation">Location Lost *</label>
                <input
                  type="text"
                  id="lostLocation"
                  placeholder="e.g., Downtown Mall, Central Station, Park Ave"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label for="itemDescription">Description *</label>
              <textarea
                id="itemDescription"
                rows="4"
                placeholder="Provide a detailed description of the item, including brand, color, size, distinguishing features, and any contents if applicable..."
                required
              ></textarea>
            </div>

            <div class="form-group">
              <label for="contactEmail">Your Email *</label>
              <input
                type="email"
                id="contactEmail"
                placeholder="We'll use this to contact you if your item is found"
                required
              />
            </div>

            <div class="form-group">
              <label>Upload Photos (Optional)</label>
              <div class="file-upload" id="fileUpload">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag and drop or click to upload photos</p>
                <p style="font-size: 0.9rem; color: var(--gray)">
                  Max file size: 5MB each
                </p>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="filter-btn reset-btn" id="cancelReport">Cancel</button>
          <button class="filter-btn apply-btn" id="submitReport">
            Submit Report
          </button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    {% include 'includes/footer.html' %}

    <script>
      // Sample lost items data
      const lostItems = [
        {
          id: 1,
          title: "iPhone 12 Pro - Space Gray",
          category: "electronics",
          categoryName: "Electronics",
          location: "Downtown Coffee Shop",
          date: "2023-10-15",
          description:
            "Lost my iPhone 12 Pro at the downtown coffee shop. It has a black case with a floral pattern on the back. The screen has a small crack on the top left corner.",
          claimed: false,
          icon: "fas fa-mobile-alt",
        },
        {
          id: 2,
          title: "Car Keys with BMW Keychain",
          category: "keys",
          categoryName: "Keys & Access",
          location: "Central Parking Garage",
          date: "2023-10-18",
          description:
            "Set of car keys with a silver BMW keychain. There are 4 keys total on the ring, including a small mailbox key.",
          claimed: false,
          icon: "fas fa-key",
        },
        {
          id: 3,
          title: "Leather Wallet - Brown",
          category: "wallets",
          categoryName: "Wallets & Purses",
          location: "City Park",
          date: "2023-10-20",
          description:
            "Brown leather wallet containing ID, credit cards, and some cash. There's a photo of my family in the clear ID window.",
          claimed: false,
          icon: "fas fa-wallet",
        },
        {
          id: 4,
          title: "Wireless Headphones - Sony WH-1000XM4",
          category: "electronics",
          categoryName: "Electronics",
          location: "Public Bus Route 42",
          date: "2023-10-22",
          description:
            "Sony noise-cancelling headphones in black. The case has a small scratch on the front. Last used on the bus yesterday morning.",
          claimed: false,
          icon: "fas fa-headphones",
        },
        {
          id: 5,
          title: "Silver Bracelet with Heart Charm",
          category: "jewelry",
          categoryName: "Jewelry & Accessories",
          location: "Shopping Mall",
          date: "2023-10-10",
          description:
            "Delicate silver bracelet with a small heart charm. The clasp is broken so it might have fallen off easily.",
          claimed: true,
          icon: "fas fa-gem",
        },
        {
          id: 6,
          title: "Passport & Travel Documents",
          category: "documents",
          categoryName: "Documents",
          location: "Airport Terminal B",
          date: "2023-10-05",
          description:
            "Blue passport with several visa stamps. Also includes boarding passes and some currency exchange receipts.",
          claimed: false,
          icon: "fas fa-passport",
        },
        {
          id: 7,
          title: "Laptop Bag - Black Targus",
          category: "bags",
          categoryName: "Bags & Luggage",
          location: "Train Station",
          date: "2023-10-25",
          description:
            "Black Targus laptop backpack. Contains a laptop charger, some notebooks, and a water bottle in the side pocket.",
          claimed: false,
          icon: "fas fa-briefcase",
        },
        {
          id: 8,
          title: "Men's Watch - Fossil",
          category: "jewelry",
          categoryName: "Jewelry & Accessories",
          location: "Gym Locker Room",
          date: "2023-10-17",
          description:
            "Brown leather strap Fossil watch with a silver face. The band is worn and has my initials engraved on the clasp.",
          claimed: false,
          icon: "fas fa-clock",
        },
      ];

      // DOM Elements
      const lostItemsGrid = document.getElementById("lostItemsGrid");
      const searchInput = document.getElementById("searchInput");
      const categoryCheckboxes = document.querySelectorAll(
        'input[type="checkbox"][id^="cat-"]'
      );
      const locationFilter = document.getElementById("locationFilter");
      const dateFrom = document.getElementById("dateFrom");
      const dateTo = document.getElementById("dateTo");
      const statusCheckboxes = document.querySelectorAll(
        'input[type="checkbox"][id^="status-"]'
      );
      const applyFiltersBtn = document.getElementById("applyFilters");
      const resetFiltersBtn = document.getElementById("resetFilters");
      const sortBy = document.getElementById("sortBy");
      const itemsShown = document.getElementById("itemsShown");
      const itemsTotal = document.getElementById("itemsTotal");
      const reportModal = document.getElementById("reportModal");
      const reportItemBtn = document.getElementById("reportItemBtn");
      const openReportModalBtn = document.getElementById("openReportModal");
      const closeModalBtn = document.getElementById("closeModal");
      const cancelReportBtn = document.getElementById("cancelReport");
      const submitReportBtn = document.getElementById("submitReport");
      const reportForm = document.getElementById("reportForm");

      // Set default dates for filters
      const today = new Date().toISOString().split("T")[0];
      const thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
      const thirtyDaysAgoStr = thirtyDaysAgo.toISOString().split("T")[0];

      dateFrom.value = thirtyDaysAgoStr;
      dateTo.value = today;

      // Set lost date default to today
      document.getElementById("lostDate").value = today;

      // Initialize items display
      function displayItems(items) {
        lostItemsGrid.innerHTML = "";

        if (items.length === 0) {
          lostItemsGrid.innerHTML = `
                    <div class="no-items">
                        <i class="fas fa-search"></i>
                        <h3>No Lost Items Found</h3>
                        <p>Try adjusting your filters or search terms</p>
                    </div>
                `;
          itemsShown.textContent = "0";
          return;
        }

        items.forEach((item) => {
          const itemCard = document.createElement("div");
          itemCard.className = "item-card";
          itemCard.innerHTML = `
                    <div class="item-image">
                        <div class="item-placeholder">
                            <i class="${item.icon}"></i>
                        </div>
                        <div class="item-category">
                            <i class="${item.icon}"></i>
                            <span>${item.categoryName}</span>
                        </div>
                    </div>
                    <div class="item-details">
                        <h3 class="item-title">${item.title}</h3>
                        <div class="item-meta">
                            <div><i class="fas fa-map-marker-alt"></i> ${
                              item.location
                            }</div>
                            <div><i class="fas fa-calendar-alt"></i> ${formatDate(
                              item.date
                            )}</div>
                        </div>
                        <p class="item-description">${item.description}</p>
                        <div class="item-actions">
                            <a href="#" class="item-btn view-btn">View Details</a>
                            ${
                              item.claimed
                                ? '<button class="item-btn" style="background-color: var(--success); color: white;" disabled>Claimed</button>'
                                : '<button class="item-btn claim-btn">I Think This Is Mine</button>'
                            }
                        </div>
                    </div>
                `;

          lostItemsGrid.appendChild(itemCard);
        });

        itemsShown.textContent = items.length.toString();
      }

      // Format date for display
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
          year: "numeric",
        });
      }

      // Filter items based on current filter values
      function filterItems() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedCategories = Array.from(categoryCheckboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.id.replace("cat-", ""));

        const selectedLocation = locationFilter.value;
        const dateFromVal = dateFrom.value ? new Date(dateFrom.value) : null;
        const dateToVal = dateTo.value ? new Date(dateTo.value) : null;

        const selectedStatus = Array.from(statusCheckboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.id.replace("status-", ""));

        // Filter items
        let filtered = lostItems.filter((item) => {
          // Search term filter
          if (
            searchTerm &&
            !item.title.toLowerCase().includes(searchTerm) &&
            !item.description.toLowerCase().includes(searchTerm) &&
            !item.location.toLowerCase().includes(searchTerm)
          ) {
            return false;
          }

          // Category filter
          if (
            selectedCategories.length > 0 &&
            !selectedCategories.includes(item.category)
          ) {
            return false;
          }

          // Location filter
          if (
            selectedLocation !== "all" &&
            !item.location.toLowerCase().includes(selectedLocation)
          ) {
            return false;
          }

          // Date filter
          const itemDate = new Date(item.date);
          if (dateFromVal && itemDate < dateFromVal) return false;
          if (dateToVal && itemDate > dateToVal) return false;

          // Status filter
          const itemStatus = item.claimed ? "claimed" : "unclaimed";
          if (
            selectedStatus.length > 0 &&
            !selectedStatus.includes(itemStatus)
          ) {
            return false;
          }

          return true;
        });

        // Sort items
        const sortValue = sortBy.value;
        filtered.sort((a, b) => {
          if (sortValue === "recent") {
            return new Date(b.date) - new Date(a.date);
          } else if (sortValue === "oldest") {
            return new Date(a.date) - new Date(b.date);
          } else if (sortValue === "location") {
            return a.location.localeCompare(b.location);
          } else if (sortValue === "category") {
            return a.categoryName.localeCompare(b.categoryName);
          }
          return 0;
        });

        return filtered;
      }

      // Apply filters and update display
      function applyFilters() {
        const filteredItems = filterItems();
        displayItems(filteredItems);
      }

      // Reset all filters
      function resetFilters() {
        searchInput.value = "";

        categoryCheckboxes.forEach((cb) => {
          if (
            cb.id === "cat-electronics" ||
            cb.id === "cat-keys" ||
            cb.id === "cat-wallets"
          ) {
            cb.checked = true;
          } else {
            cb.checked = false;
          }
        });

        locationFilter.value = "all";

        dateFrom.value = thirtyDaysAgoStr;
        dateTo.value = today;

        statusCheckboxes.forEach((cb) => {
          cb.checked = cb.id === "status-unclaimed";
        });

        sortBy.value = "recent";

        applyFilters();
      }

      // Modal functions
      function openModal() {
        reportModal.style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        reportModal.style.display = "none";
        document.body.style.overflow = "auto";
        reportForm.reset();
        document.getElementById("lostDate").value = today;
      }

      // Initialize page
      function initPage() {
        itemsTotal.textContent = lostItems.length.toString();
        displayItems(lostItems);

        // Add event listeners
        applyFiltersBtn.addEventListener("click", applyFilters);
        resetFiltersBtn.addEventListener("click", resetFilters);
        searchInput.addEventListener("input", applyFilters);
        sortBy.addEventListener("change", applyFilters);

        // Modal event listeners
        reportItemBtn.addEventListener("click", openModal);
        openReportModalBtn.addEventListener("click", openModal);
        closeModalBtn.addEventListener("click", closeModal);
        cancelReportBtn.addEventListener("click", closeModal);

        // Close modal when clicking outside
        reportModal.addEventListener("click", function (e) {
          if (e.target === reportModal) {
            closeModal();
          }
        });

        // Submit report
        submitReportBtn.addEventListener("click", function (e) {
          e.preventDefault();

          // Basic form validation
          const itemName = document.getElementById("itemName").value;
          const itemCategory = document.getElementById("itemCategory").value;
          const lostDate = document.getElementById("lostDate").value;
          const lostLocation = document.getElementById("lostLocation").value;
          const itemDescription =
            document.getElementById("itemDescription").value;
          const contactEmail = document.getElementById("contactEmail").value;

          if (
            !itemName ||
            !itemCategory ||
            !lostDate ||
            !lostLocation ||
            !itemDescription ||
            !contactEmail
          ) {
            alert("Please fill in all required fields.");
            return;
          }

          // In a real app, you would submit this data to a server
          alert(
            "Thank you for reporting your lost item. We'll notify you if someone finds it!"
          );
          closeModal();
        });

        // File upload interaction
        const fileUpload = document.getElementById("fileUpload");
        fileUpload.addEventListener("click", function () {
          alert("In a real application, this would open a file picker dialog.");
        });
      }

      // Initialize the page when DOM is loaded
      document.addEventListener("DOMContentLoaded", initPage);
    </script>
  </body>
</html>
