{% load static%}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Found Items - Reclaima</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="{% static 'css/found_items.css'%}" />
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="container header-container">
        <a href="index.html" class="logo">
          <i class="fas fa-search"></i>
          Reclaim<span>a</span>
        </a>

        <nav>
          <ul>
            <li><a href="{% url 'home' %}">Home</a></li>
            <li><a href="{% url 'lostItems' %}">Lost Items</a></li>
            <li><a href="{% url 'found' %}" class="active">Found Items</a></li>
            <li><a href="{% url 'howItWorks' %}">How It Works</a></li>
            <li><a href="{% url 'successStories' %}">Success Stories</a></li>
          </ul>
        </nav>

        <div class="cta-buttons">
          <button class="cta-button" id="reportItemBtn">
            Report Found Item
          </button>
        </div>

        <div class="mobile-menu">
          <i class="fas fa-bars"></i>
        </div>
      </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
      <div class="container">
        <h1 class="page-title">Found Items</h1>
        <p class="page-subtitle">
          Browse through items that have been found by others. If you see
          something that belongs to you or someone you know, you can claim it.
          If you've found something, you can report it to help reunite it with
          its owner.
        </p>

        <div class="header-stats">
          <div class="stat">
            <div class="stat-number">1,245</div>
            <div class="stat-label">Items Currently Listed</div>
          </div>
          <div class="stat">
            <div class="stat-number">892</div>
            <div class="stat-label">Items Returned This Month</div>
          </div>
          <div class="stat">
            <div class="stat-number">72%</div>
            <div class="stat-label">Return Rate</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <div class="container">
      <div class="main-content">
        <!-- Filter Sidebar -->
        <aside class="filter-sidebar">
          <h2 class="filter-title">
            <i class="fas fa-filter"></i> Filter Results
          </h2>

          <!-- Search -->
          <div class="filter-group">
            <h3>Search</h3>
            <input
              type="text"
              id="searchInput"
              placeholder="Type item name or description..."
              style="
                width: 100%;
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 1rem;
              "
            />
          </div>

          <!-- Category -->
          <div class="filter-group">
            <h3>Category</h3>
            <div class="filter-options">
              <div class="filter-option">
                <input type="checkbox" id="cat-electronics" checked />
                <label for="cat-electronics">Electronics</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-keys" checked />
                <label for="cat-keys">Keys & Access</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-wallets" checked />
                <label for="cat-wallets">Wallets & Purses</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-documents" />
                <label for="cat-documents">Documents</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-jewelry" />
                <label for="cat-jewelry">Jewelry & Accessories</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-clothing" />
                <label for="cat-clothing">Clothing</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-bags" />
                <label for="cat-bags">Bags & Luggage</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-other" />
                <label for="cat-other">Other</label>
              </div>
            </div>
          </div>

          <!-- Location Found -->
          <div class="filter-group">
            <h3>Location Found</h3>
            <select
              id="locationFilter"
              style="
                width: 100%;
                padding: 10px 15px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 1rem;
              "
            >
              <option value="all">All Locations</option>
              <option value="downtown">Downtown</option>
              <option value="north">North District</option>
              <option value="south">South District</option>
              <option value="east">East Side</option>
              <option value="west">West Side</option>
              <option value="transport">Public Transport</option>
              <option value="airport">Airport</option>
            </select>
          </div>

          <!-- Date Found -->
          <div class="filter-group">
            <h3>Date Found</h3>
            <div class="date-inputs">
              <input type="date" id="dateFrom" />
              <input type="date" id="dateTo" />
            </div>
          </div>

          <!-- Status -->
          <div class="filter-group">
            <h3>Status</h3>
            <div class="filter-options">
              <div class="filter-option">
                <input type="checkbox" id="status-unclaimed" checked />
                <label for="status-unclaimed">Unclaimed</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="status-claimed" />
                <label for="status-claimed">Claimed</label>
              </div>
            </div>
          </div>

          <!-- Filter Buttons -->
          <div class="filter-buttons">
            <button class="filter-btn apply-btn" id="applyFilters">
              Apply Filters
            </button>
            <button class="filter-btn reset-btn" id="resetFilters">
              Reset
            </button>
          </div>
        </aside>

        <!-- Items Grid -->
        <main class="items-container">
          <div class="items-header">
            <div class="items-count">
              Showing <span id="itemsShown">8</span> of
              <span id="itemsTotal">1,245</span> found items
            </div>
            <div class="sort-options">
              <span>Sort by:</span>
              <select id="sortBy">
                <option value="recent">Most Recent</option>
                <option value="oldest">Oldest First</option>
                <option value="location">Location</option>
                <option value="category">Category</option>
              </select>
            </div>
          </div>

          <div class="items-grid" id="foundItemsGrid">
            <!-- Item cards will be dynamically generated here -->
          </div>

          <!-- Pagination -->
          <div class="pagination">
            <button class="page-btn active">1</button>
            <button class="page-btn">2</button>
            <button class="page-btn">3</button>
            <button class="page-btn">4</button>
            <button class="page-btn">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </main>
      </div>

      <!-- Report Section -->
      <section class="report-section">
        <h2 class="report-title">Found Something That Isn't Yours?</h2>
        <p class="report-text">
          If you've found an item that doesn't belong to you, you can report it
          here. Your report could help reunite someone with their lost
          belongings. Remember to provide as much detail as possible.
        </p>
        <button class="cta-button" id="openReportModal">
          Report a Found Item
        </button>
      </section>
    </div>

    <!-- Report Item Modal -->
    <div class="modal" id="reportModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Report a Found Item</h2>
          <button class="close-modal" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="found-location-info">
            <h4><i class="fas fa-info-circle"></i> Before You Report</h4>
            <p>
              Please make sure you've taken reasonable steps to find the owner
              locally before reporting here. Check if there's an ID or contact
              information in the item.
            </p>
          </div>

          <form id="reportForm">
            <div class="form-row">
              <div class="form-group">
                <label for="itemName">Item Name *</label>
                <input
                  type="text"
                  id="itemName"
                  placeholder="e.g., iPhone 12, Black Wallet, Car Keys"
                  required
                />
              </div>
              <div class="form-group">
                <label for="itemCategory">Category *</label>
                <select id="itemCategory" required>
                  <option value="">Select a category</option>
                  <option value="electronics">Electronics</option>
                  <option value="keys">Keys & Access</option>
                  <option value="wallets">Wallets & Purses</option>
                  <option value="documents">Documents</option>
                  <option value="jewelry">Jewelry & Accessories</option>
                  <option value="clothing">Clothing</option>
                  <option value="bags">Bags & Luggage</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="foundDate">Date Found *</label>
                <input type="date" id="foundDate" required />
              </div>
              <div class="form-group">
                <label for="foundLocation">Location Found *</label>
                <input
                  type="text"
                  id="foundLocation"
                  placeholder="e.g., Downtown Mall, Central Station, Park Ave"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label for="foundAddress">Specific Address (Optional)</label>
              <input
                type="text"
                id="foundAddress"
                placeholder="Exact address or location details"
              />
            </div>

            <div class="form-group">
              <label for="itemDescription">Description *</label>
              <textarea
                id="itemDescription"
                rows="4"
                placeholder="Provide a detailed description of the item, including brand, color, size, distinguishing features, and any contents if applicable..."
                required
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="finderName">Your Name *</label>
                <input
                  type="text"
                  id="finderName"
                  placeholder="How should we refer to you?"
                  required
                />
              </div>
              <div class="form-group">
                <label for="contactEmail">Your Email *</label>
                <input
                  type="email"
                  id="contactEmail"
                  placeholder="We'll use this to connect you with the owner"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label>Upload Photos (Optional but helpful)</label>
              <div class="file-upload" id="fileUpload">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag and drop or click to upload photos of the found item</p>
                <p style="font-size: 0.9rem; color: var(--gray)">
                  Max file size: 5MB each
                </p>
              </div>
            </div>

            <div class="form-group">
              <div class="filter-option">
                <input type="checkbox" id="safeStorage" required />
                <label for="safeStorage"
                  >I agree to safely store this item until the owner is found
                  *</label
                >
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="filter-btn reset-btn" id="cancelReport">Cancel</button>
          <button class="filter-btn apply-btn" id="submitReport">
            Submit Report
          </button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    {% include 'includes/footer.html' %}

    <script>
      // Sample found items data
      const foundItems = [
        {
          id: 1,
          title: "iPhone 12 Pro - Space Gray",
          category: "electronics",
          categoryName: "Electronics",
          location: "Downtown Coffee Shop",
          date: "2023-10-15",
          description:
            "Found on a table near the window. Black case with floral pattern. Screen has a small crack on top left corner.",
          status: "unclaimed",
          icon: "fas fa-mobile-alt",
          finder: "Coffee Shop Staff",
        },
        {
          id: 2,
          title: "Car Keys with BMW Keychain",
          category: "keys",
          categoryName: "Keys & Access",
          location: "Central Parking Garage, Level 3",
          date: "2023-10-18",
          description:
            "Set of car keys found near elevator. Silver BMW keychain with 4 keys total, including a small mailbox key.",
          status: "unclaimed",
          icon: "fas fa-key",
          finder: "Parking Attendant",
        },
        {
          id: 3,
          title: "Leather Wallet - Brown",
          category: "wallets",
          categoryName: "Wallets & Purses",
          location: "City Park, Near Fountain",
          date: "2023-10-20",
          description:
            "Brown leather wallet containing ID, credit cards, and some cash. Photo of a family in the ID window.",
          status: "claimed",
          icon: "fas fa-wallet",
          finder: "Park Visitor",
        },
        {
          id: 4,
          title: "Wireless Headphones - Sony WH-1000XM4",
          category: "electronics",
          categoryName: "Electronics",
          location: "Public Bus Route 42",
          date: "2023-10-22",
          description:
            "Sony noise-cancelling headphones in black case. Case has small scratch on front. Found on seat near back.",
          status: "unclaimed",
          icon: "fas fa-headphones",
          finder: "Bus Driver",
        },
        {
          id: 5,
          title: "Silver Bracelet with Heart Charm",
          category: "jewelry",
          categoryName: "Jewelry & Accessories",
          location: "Shopping Mall, Food Court",
          date: "2023-10-10",
          description:
            "Delicate silver bracelet with small heart charm. Clasp appears to be broken.",
          status: "unclaimed",
          icon: "fas fa-gem",
          finder: "Mall Security",
        },
        {
          id: 6,
          title: "Passport & Travel Documents",
          category: "documents",
          categoryName: "Documents",
          location: "Airport Terminal B, Security Check",
          date: "2023-10-05",
          description:
            "Blue passport with several visa stamps. Includes boarding passes and currency exchange receipts.",
          status: "claimed",
          icon: "fas fa-passport",
          finder: "TSA Officer",
        },
        {
          id: 7,
          title: "Laptop Bag - Black Targus",
          category: "bags",
          categoryName: "Bags & Luggage",
          location: "Train Station, Waiting Area",
          date: "2023-10-25",
          description:
            "Black Targus laptop backpack. Contains laptop charger, notebooks, and water bottle in side pocket.",
          status: "unclaimed",
          icon: "fas fa-briefcase",
          finder: "Station Staff",
        },
        {
          id: 8,
          title: "Men's Watch - Fossil",
          category: "jewelry",
          categoryName: "Jewelry & Accessories",
          location: "Gym Locker Room",
          date: "2023-10-17",
          description:
            "Brown leather strap Fossil watch with silver face. Band is worn with initials engraved on clasp.",
          status: "unclaimed",
          icon: "fas fa-clock",
          finder: "Gym Member",
        },
      ];

      // DOM Elements
      const foundItemsGrid = document.getElementById("foundItemsGrid");
      const searchInput = document.getElementById("searchInput");
      const categoryCheckboxes = document.querySelectorAll(
        'input[type="checkbox"][id^="cat-"]'
      );
      const locationFilter = document.getElementById("locationFilter");
      const dateFrom = document.getElementById("dateFrom");
      const dateTo = document.getElementById("dateTo");
      const statusCheckboxes = document.querySelectorAll(
        'input[type="checkbox"][id^="status-"]'
      );
      const applyFiltersBtn = document.getElementById("applyFilters");
      const resetFiltersBtn = document.getElementById("resetFilters");
      const sortBy = document.getElementById("sortBy");
      const itemsShown = document.getElementById("itemsShown");
      const reportModal = document.getElementById("reportModal");
      const reportItemBtn = document.getElementById("reportItemBtn");
      const openReportModalBtn = document.getElementById("openReportModal");
      const closeModalBtn = document.getElementById("closeModal");
      const cancelReportBtn = document.getElementById("cancelReport");
      const submitReportBtn = document.getElementById("submitReport");
      const reportForm = document.getElementById("reportForm");

      // Set default dates for filters
      const today = new Date().toISOString().split("T")[0];
      const thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
      const thirtyDaysAgoStr = thirtyDaysAgo.toISOString().split("T")[0];

      dateFrom.value = thirtyDaysAgoStr;
      dateTo.value = today;

      // Set found date default to today
      document.getElementById("foundDate").value = today;

      // Initialize items display
      function displayItems(items) {
        foundItemsGrid.innerHTML = "";

        if (items.length === 0) {
          foundItemsGrid.innerHTML = `
                    <div class="no-items">
                        <i class="fas fa-search"></i>
                        <h3>No Found Items Match Your Search</h3>
                        <p>Try adjusting your filters or search terms</p>
                    </div>
                `;
          itemsShown.textContent = "0";
          return;
        }

        items.forEach((item) => {
          const itemCard = document.createElement("div");
          itemCard.className = "item-card";
          itemCard.innerHTML = `
                    <div class="item-image">
                        <div class="item-placeholder">
                            <i class="${item.icon}"></i>
                        </div>
                        <div class="item-category">
                            <i class="${item.icon}"></i>
                            <span>${item.categoryName}</span>
                        </div>
                        <div class="item-status ${
                          item.status === "claimed"
                            ? "status-claimed"
                            : "status-unclaimed"
                        }">
                            ${
                              item.status === "claimed"
                                ? "Claimed"
                                : "Unclaimed"
                            }
                        </div>
                    </div>
                    <div class="item-details">
                        <h3 class="item-title">${item.title}</h3>
                        <div class="item-meta">
                            <div><i class="fas fa-map-marker-alt"></i> ${
                              item.location
                            }</div>
                            <div><i class="fas fa-calendar-alt"></i> ${formatDate(
                              item.date
                            )}</div>
                            <div><i class="fas fa-user"></i> ${
                              item.finder
                            }</div>
                        </div>
                        <p class="item-description">${item.description}</p>
                        <div class="item-actions">
                            <a href="#" class="item-btn view-btn">View Details</a>
                            ${
                              item.status === "claimed"
                                ? '<button class="item-btn" style="background-color: var(--success); color: white;" disabled>Already Claimed</button>'
                                : '<button class="item-btn claim-btn">I Think This Is Mine</button>'
                            }
                        </div>
                    </div>
                `;

          foundItemsGrid.appendChild(itemCard);
        });

        itemsShown.textContent = items.length.toString();
      }

      // Format date for display
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
          year: "numeric",
        });
      }

      // Filter items based on current filter values
      function filterItems() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedCategories = Array.from(categoryCheckboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.id.replace("cat-", ""));

        const selectedLocation = locationFilter.value;
        const dateFromVal = dateFrom.value ? new Date(dateFrom.value) : null;
        const dateToVal = dateTo.value ? new Date(dateTo.value) : null;

        const selectedStatus = Array.from(statusCheckboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.id.replace("status-", ""));

        // Filter items
        let filtered = foundItems.filter((item) => {
          // Search term filter
          if (
            searchTerm &&
            !item.title.toLowerCase().includes(searchTerm) &&
            !item.description.toLowerCase().includes(searchTerm) &&
            !item.location.toLowerCase().includes(searchTerm) &&
            !item.finder.toLowerCase().includes(searchTerm)
          ) {
            return false;
          }

          // Category filter
          if (
            selectedCategories.length > 0 &&
            !selectedCategories.includes(item.category)
          ) {
            return false;
          }

          // Location filter
          if (
            selectedLocation !== "all" &&
            !item.location.toLowerCase().includes(selectedLocation)
          ) {
            return false;
          }

          // Date filter
          const itemDate = new Date(item.date);
          if (dateFromVal && itemDate < dateFromVal) return false;
          if (dateToVal && itemDate > dateToVal) return false;

          // Status filter
          const itemStatus =
            item.status === "claimed" ? "claimed" : "unclaimed";
          if (
            selectedStatus.length > 0 &&
            !selectedStatus.includes(itemStatus)
          ) {
            return false;
          }

          return true;
        });

        // Sort items
        const sortValue = sortBy.value;
        filtered.sort((a, b) => {
          if (sortValue === "recent") {
            return new Date(b.date) - new Date(a.date);
          } else if (sortValue === "oldest") {
            return new Date(a.date) - new Date(b.date);
          } else if (sortValue === "location") {
            return a.location.localeCompare(b.location);
          } else if (sortValue === "category") {
            return a.categoryName.localeCompare(b.categoryName);
          }
          return 0;
        });

        return filtered;
      }

      // Apply filters and update display
      function applyFilters() {
        const filteredItems = filterItems();
        displayItems(filteredItems);
      }

      // Reset all filters
      function resetFilters() {
        searchInput.value = "";

        categoryCheckboxes.forEach((cb) => {
          if (
            cb.id === "cat-electronics" ||
            cb.id === "cat-keys" ||
            cb.id === "cat-wallets"
          ) {
            cb.checked = true;
          } else {
            cb.checked = false;
          }
        });

        locationFilter.value = "all";

        dateFrom.value = thirtyDaysAgoStr;
        dateTo.value = today;

        statusCheckboxes.forEach((cb) => {
          cb.checked = cb.id === "status-unclaimed";
        });

        sortBy.value = "recent";

        applyFilters();
      }

      // Modal functions
      function openModal() {
        reportModal.style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        reportModal.style.display = "none";
        document.body.style.overflow = "auto";
        reportForm.reset();
        document.getElementById("foundDate").value = today;
        document.getElementById("safeStorage").checked = false;
      }

      // Initialize page
      function initPage() {
        displayItems(foundItems);

        // Add event listeners
        applyFiltersBtn.addEventListener("click", applyFilters);
        resetFiltersBtn.addEventListener("click", resetFilters);
        searchInput.addEventListener("input", applyFilters);
        sortBy.addEventListener("change", applyFilters);

        // Modal event listeners
        reportItemBtn.addEventListener("click", openModal);
        openReportModalBtn.addEventListener("click", openModal);
        closeModalBtn.addEventListener("click", closeModal);
        cancelReportBtn.addEventListener("click", closeModal);

        // Close modal when clicking outside
        reportModal.addEventListener("click", function (e) {
          if (e.target === reportModal) {
            closeModal();
          }
        });

        // Submit report
        submitReportBtn.addEventListener("click", function (e) {
          e.preventDefault();

          // Basic form validation
          const itemName = document.getElementById("itemName").value;
          const itemCategory = document.getElementById("itemCategory").value;
          const foundDate = document.getElementById("foundDate").value;
          const foundLocation = document.getElementById("foundLocation").value;
          const itemDescription =
            document.getElementById("itemDescription").value;
          const finderName = document.getElementById("finderName").value;
          const contactEmail = document.getElementById("contactEmail").value;
          const safeStorage = document.getElementById("safeStorage").checked;

          if (
            !itemName ||
            !itemCategory ||
            !foundDate ||
            !foundLocation ||
            !itemDescription ||
            !finderName ||
            !contactEmail ||
            !safeStorage
          ) {
            alert(
              "Please fill in all required fields and agree to store the item safely."
            );
            return;
          }

          // In a real app, you would submit this data to a server
          alert(
            "Thank you for reporting the found item! We'll help connect you with the owner if they come forward."
          );
          closeModal();

          // Add the new item to the list (in a real app, this would come from the server)
          const newItem = {
            id: foundItems.length + 1,
            title: itemName,
            category: itemCategory,
            categoryName:
              itemCategory.charAt(0).toUpperCase() + itemCategory.slice(1),
            location: foundLocation,
            date: foundDate,
            description: itemDescription,
            status: "unclaimed",
            icon: getIconForCategory(itemCategory),
            finder: finderName,
          };

          foundItems.unshift(newItem);
          applyFilters();
        });

        // File upload interaction
        const fileUpload = document.getElementById("fileUpload");
        fileUpload.addEventListener("click", function () {
          alert("In a real application, this would open a file picker dialog.");
        });

        // Mobile menu toggle
        document
          .querySelector(".mobile-menu")
          .addEventListener("click", function () {
            document.querySelector("nav ul").style.display =
              document.querySelector("nav ul").style.display === "flex"
                ? "none"
                : "flex";
          });

        // Pagination
        document.querySelectorAll(".page-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document
              .querySelectorAll(".page-btn")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");

            // In a real app, this would load the corresponding page of results
            if (!this.querySelector("i")) {
              alert(`Loading page ${this.textContent}...`);
            }
          });
        });
      }

      // Helper function to get icon for category
      function getIconForCategory(category) {
        switch (category) {
          case "electronics":
            return "fas fa-mobile-alt";
          case "keys":
            return "fas fa-key";
          case "wallets":
            return "fas fa-wallet";
          case "documents":
            return "fas fa-passport";
          case "jewelry":
            return "fas fa-gem";
          case "clothing":
            return "fas fa-tshirt";
          case "bags":
            return "fas fa-briefcase";
          default:
            return "fas fa-question-circle";
        }
      }

      // Initialize the page when DOM is loaded
      document.addEventListener("DOMContentLoaded", initPage);
    </script>
  </body>
</html>
